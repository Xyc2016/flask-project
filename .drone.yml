kind: pipeline
type: kubernetes # Note, it's where your runners run.
name: default

# steps:
# - name: install
#   image: python:3.12-slim
#   commands:
#   - pip install -r requirements.txt

steps:
  - name: build
    image: plugins/docker
    volumes:
      - name: dockersock
        path: /var/run
    settings:
      repo: 192.168.49.2:5000/fstack-be
      tags:
        - ${DRONE_COMMIT_SHA:0:8}
        - latest
      registry: 192.168.49.2:5000
      insecure: true
    when:
      event: [push]

services:
  - name: docker
    image: docker:dind
    privileged: true
    command: ["sh", "-c", "dockerd --insecure-registry 192.168.49.2:5000"]
    volumes:
      - name: dockersock
        path: /var/run

volumes:
  - name: dockersock
    temp: {}
